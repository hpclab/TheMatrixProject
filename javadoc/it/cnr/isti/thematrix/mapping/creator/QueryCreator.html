<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_67) on Mon Sep 01 14:10:27 CEST 2014 -->
<title>QueryCreator</title>
<meta name="date" content="2014-09-01">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="QueryCreator";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/QueryCreator.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/MySQLAccess.html" title="class in it.cnr.isti.thematrix.mapping.creator"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/ValueRemapper.html" title="class in it.cnr.isti.thematrix.mapping.creator"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?it/cnr/isti/thematrix/mapping/creator/QueryCreator.html" target="_top">Frames</a></li>
<li><a href="QueryCreator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">it.cnr.isti.thematrix.mapping.creator</div>
<h2 title="Class QueryCreator" class="title">Class QueryCreator</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>it.cnr.isti.thematrix.mapping.creator.QueryCreator</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">QueryCreator</span>
extends java.lang.Object</pre>
<div class="block">This class generates the test of SQL queries needed to extract a IAD dataset file from a DBMS. Method
 <code>computeQuerySet</code> does the hard part. <br>
 TODO : REFACTOR! all internal-only functions should receive the dataset instance and not look up again in the
 singleton. (and be made private).</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#QueryCreator()">QueryCreator</a></strong>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#buildQuery(java.lang.String,%20it.cnr.isti.thematrix.configuration.mapping.Dataset,%20java.util.Collection)">buildQuery</a></strong>(java.lang.String&nbsp;LIADTableName,
          <a href="../../../../../../it/cnr/isti/thematrix/configuration/mapping/Dataset.html" title="class in it.cnr.isti.thematrix.configuration.mapping">Dataset</a>&nbsp;d,
          java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames)</code>
<div class="block">Generates an SQL query which does NOT require a Join clause (single source table).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#buildQueryWithJoin(java.util.Collection,%20it.cnr.isti.thematrix.configuration.mapping.Dataset,%20java.util.Collection,%20java.lang.String)">buildQueryWithJoin</a></strong>(java.util.Collection&lt;java.lang.String&gt;&nbsp;LIADTableNames,
                  <a href="../../../../../../it/cnr/isti/thematrix/configuration/mapping/Dataset.html" title="class in it.cnr.isti.thematrix.configuration.mapping">Dataset</a>&nbsp;d,
                  java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames,
                  java.lang.String&nbsp;joinClause)</code>
<div class="block">Generates a SQL query for a IAD dataset whose mapping DOES use a join clause (multiple source table).</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.util.Collection&lt;<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QueryDescriptor.html" title="class in it.cnr.isti.thematrix.mapping.utils">QueryDescriptor</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#computeQuerySet(java.lang.String,%20java.util.Collection)">computeQuerySet</a></strong>(java.lang.String&nbsp;dataset,
               java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames)</code>
<div class="block">Computes the set of SQL queries required to extract data from a DBMS to map a IAD dataset.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#dumpQueries(it.cnr.isti.thematrix.mapping.utils.QuerySet,%20java.lang.String)">dumpQueries</a></strong>(<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QuerySet.html" title="class in it.cnr.isti.thematrix.mapping.utils">QuerySet</a>&nbsp;querySet,
           java.lang.String&nbsp;scriptName)</code>
<div class="block">Writes a set of queries to a text file.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.util.Collection&lt;<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QueryDescriptor.html" title="class in it.cnr.isti.thematrix.mapping.utils">QueryDescriptor</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#getQueryDescriptor(java.lang.String)">getQueryDescriptor</a></strong>(java.lang.String&nbsp;datasetName)</code>
<div class="block">Return a Collection of <code>QueryDescriptor</code> for queries needed to build a whole IAD dataset (all
 attributes), by looking up in the MappingSingleton.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static java.util.Collection&lt;<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QueryDescriptor.html" title="class in it.cnr.isti.thematrix.mapping.utils">QueryDescriptor</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#getQueryDescriptor(java.lang.String,%20java.util.Collection)">getQueryDescriptor</a></strong>(java.lang.String&nbsp;datasetName,
                  java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames)</code>
<div class="block">Method that returns a collection of queries starting from a dataset name and a list of attributes to map.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/QueryCreator.html#limitQuerySize(java.lang.String)">limitQuerySize</a></strong>(java.lang.String&nbsp;freeQuery)</code>
<div class="block">Generate and add an extra query clause which limits the size of the query result to a few thousand rows.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="QueryCreator()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>QueryCreator</h4>
<pre>public&nbsp;QueryCreator()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getQueryDescriptor(java.lang.String, java.util.Collection)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getQueryDescriptor</h4>
<pre>public static&nbsp;java.util.Collection&lt;<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QueryDescriptor.html" title="class in it.cnr.isti.thematrix.mapping.utils">QueryDescriptor</a>&gt;&nbsp;getQueryDescriptor(java.lang.String&nbsp;datasetName,
                                                       java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames)</pre>
<div class="block">Method that returns a collection of queries starting from a dataset name and a list of attributes to map.
 
 TODO check that the inner call to <code>computeQuerySet</code> actually does all the dirty work.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>datasetName</code> - </dd><dd><code>attributeNames</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd>A <code>Collection<QueryDescriptor></code></dd></dl>
</li>
</ul>
<a name="getQueryDescriptor(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getQueryDescriptor</h4>
<pre>public static&nbsp;java.util.Collection&lt;<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QueryDescriptor.html" title="class in it.cnr.isti.thematrix.mapping.utils">QueryDescriptor</a>&gt;&nbsp;getQueryDescriptor(java.lang.String&nbsp;datasetName)
                                                                throws <a href="../../../../../../it/cnr/isti/thematrix/exception/SyntaxErrorInMappingException.html" title="class in it.cnr.isti.thematrix.exception">SyntaxErrorInMappingException</a></pre>
<div class="block">Return a Collection of <code>QueryDescriptor</code> for queries needed to build a whole IAD dataset (all
 attributes), by looking up in the MappingSingleton.
 
 It gets attribute name list from <code>MappingSingleton</code>, then calls more general version of itself.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>datasetName</code> - The name of a IAD dataset.</dd>
<dt><span class="strong">Returns:</span></dt><dd>A <code>Collection<QueryDescriptor></code> holding the attribute names to be retrieved</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../../../../it/cnr/isti/thematrix/exception/SyntaxErrorInMappingException.html" title="class in it.cnr.isti.thematrix.exception">SyntaxErrorInMappingException</a></code></dd></dl>
</li>
</ul>
<a name="computeQuerySet(java.lang.String, java.util.Collection)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeQuerySet</h4>
<pre>public static&nbsp;java.util.Collection&lt;<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QueryDescriptor.html" title="class in it.cnr.isti.thematrix.mapping.utils">QueryDescriptor</a>&gt;&nbsp;computeQuerySet(java.lang.String&nbsp;dataset,
                                                    java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames)</pre>
<div class="block">Computes the set of SQL queries required to extract data from a DBMS to map a IAD dataset. <br>
 TODO should be made private (breaks TestQueryCreator); should not look again for the dataset by name.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>dataset</code> - The name of the IAD dataset.</dd><dd><code>attributeNames</code> - A <code>Collection<String></code> representing the attributes</dd>
<dt><span class="strong">Returns:</span></dt><dd>A <code>Collection<QueryDescriptor></code></dd></dl>
</li>
</ul>
<a name="buildQuery(java.lang.String, it.cnr.isti.thematrix.configuration.mapping.Dataset, java.util.Collection)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buildQuery</h4>
<pre>private static&nbsp;java.lang.String&nbsp;buildQuery(java.lang.String&nbsp;LIADTableName,
                          <a href="../../../../../../it/cnr/isti/thematrix/configuration/mapping/Dataset.html" title="class in it.cnr.isti.thematrix.configuration.mapping">Dataset</a>&nbsp;d,
                          java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames)</pre>
<div class="block">Generates an SQL query which does NOT require a Join clause (single source table). Creates the list of
 tablename.fields to extract, translated to the DB schema column names, and properly formatted for the DB; add the
 from clause. Can limit the query output size during test runs. <br>
 TODO Refactor, buildQuery should call / share implementation with buildQueryWithJoin</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>LIADTableName</code> - the name of the LIAD table from which we want to extract the attributes</dd><dd><code>d</code> - the IAD <code>Dataset</code> to be mapped.</dd><dd><code>attributeNames</code> - A <code>Collection<String></code> of IAD attributes that has to be mapped.</dd>
<dt><span class="strong">Returns:</span></dt><dd>The query expressed as a <code>String</code>.</dd></dl>
</li>
</ul>
<a name="buildQueryWithJoin(java.util.Collection, it.cnr.isti.thematrix.configuration.mapping.Dataset, java.util.Collection, java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>buildQueryWithJoin</h4>
<pre>private static&nbsp;java.lang.String&nbsp;buildQueryWithJoin(java.util.Collection&lt;java.lang.String&gt;&nbsp;LIADTableNames,
                                  <a href="../../../../../../it/cnr/isti/thematrix/configuration/mapping/Dataset.html" title="class in it.cnr.isti.thematrix.configuration.mapping">Dataset</a>&nbsp;d,
                                  java.util.Collection&lt;java.lang.String&gt;&nbsp;attributeNames,
                                  java.lang.String&nbsp;joinClause)</pre>
<div class="block">Generates a SQL query for a IAD dataset whose mapping DOES use a join clause (multiple source table). Creates the
 list of tablename.fields to extract collecting from each table, translated to the DB schema column names, and
 properly formatted for the DB; add the from clause and the JOIN clause passed as argument. Can limit the query
 output size during test runs.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>LIADTableNames</code> - The <code>Collection<String></code> of LIAD tables from which to query against.</dd><dd><code>d</code> - The IAD <code>Dataset</code> to be mapped.</dd><dd><code>attributeNames</code> - A <code>Collection<String></code> of IAD attributes that has to be mapped.</dd><dd><code>joinClause</code> - A <code>String</code> containing the join clause for the query.</dd>
<dt><span class="strong">Returns:</span></dt><dd>The query expressed as a <code>String</code>.</dd></dl>
</li>
</ul>
<a name="limitQuerySize(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>limitQuerySize</h4>
<pre>private static&nbsp;java.lang.String&nbsp;limitQuerySize(java.lang.String&nbsp;freeQuery)</pre>
<div class="block">Generate and add an extra query clause which limits the size of the query result to a few thousand rows. It must
 choose the clause form that is understood by the current DBMS. Since the extra clause may need to be at the
 beginning or end of query, we need to mingle with the formed query.
 
 Used only during tests to avoid that unlimited join op.s bring down the DBMS. <b>Shall not</b> be used in real
 queries, it will produce grossly incorrect results.
 
 Warning: needs extra care in checking the correct size of the returned result (off-by-one issues).
 
 TODO: Code supports Oracle, MySQL, postgres, SQLServer, but <i>only Oracle syntax</i> has been tested so far.<br>
 FIXME: will need changes when multiple drivers can be enabled at once.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>freeQuery</code> - String with the text of the query we want to add the limit clause to.</dd>
<dt><span class="strong">Returns:</span></dt><dd>a String with the final SQL query.</dd></dl>
</li>
</ul>
<a name="dumpQueries(it.cnr.isti.thematrix.mapping.utils.QuerySet, java.lang.String)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>dumpQueries</h4>
<pre>public static&nbsp;void&nbsp;dumpQueries(<a href="../../../../../../it/cnr/isti/thematrix/mapping/utils/QuerySet.html" title="class in it.cnr.isti.thematrix.mapping.utils">QuerySet</a>&nbsp;querySet,
               java.lang.String&nbsp;scriptName)
                        throws javax.xml.bind.JAXBException,
                               java.io.IOException</pre>
<div class="block">Writes a set of queries to a text file.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>querySet</code> - The <code>QuerySet</code> containing queries to be written on file.</dd><dd><code>scriptName</code> - The name of script whose execution has implied the creation of the query set.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>javax.xml.bind.JAXBException</code></dd>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/QueryCreator.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/MySQLAccess.html" title="class in it.cnr.isti.thematrix.mapping.creator"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../../it/cnr/isti/thematrix/mapping/creator/ValueRemapper.html" title="class in it.cnr.isti.thematrix.mapping.creator"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?it/cnr/isti/thematrix/mapping/creator/QueryCreator.html" target="_top">Frames</a></li>
<li><a href="QueryCreator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
